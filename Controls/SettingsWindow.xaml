<Window x:Class="MiniCalendar.Controls.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:MiniCalendar.Controls"
        Title="设置" 
        Height="520" Width="500"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
        ResizeMode="NoResize"
        Icon="pack://application:,,,/AppIconWithBg.ico"
        WindowStyle="SingleBorderWindow">

    <Window.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
        </Style>
    </Window.Resources>
    
    <Border Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" Padding="20">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- 常规设置 -->
                <RowDefinition Height="*"/>    <!-- ICS源列表 -->
                <RowDefinition Height="Auto"/> <!-- 底部按钮 -->
            </Grid.RowDefinitions>
            
            <!-- 常规设置区域 -->
            <GroupBox Grid.Row="0" Header="常规选项" Margin="0,0,0,20" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}">
                <StackPanel Margin="10">
                    <CheckBox x:Name="AutoStartCheckBox" 
                             Content="开机启动"
                             Margin="0,0,0,10"
                             VerticalAlignment="Center"
                             Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"
                             Click="AutoStartCheckBox_Click"/>
                             
                    <CheckBox x:Name="ShowChinaHolidayCheckBox" 
                             Content="显示中国节假日"
                             Margin="0,0,0,10"
                             VerticalAlignment="Center"
                             Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"
                             Click="ShowChinaHolidayCheckBox_Click"/>

                    <StackPanel Orientation="Horizontal">
                        <Label Content="主题：" VerticalAlignment="Center" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" Padding="0,0,5,0"/>
                        <ComboBox x:Name="ThemeComboBox" Width="120"
                                  SelectionChanged="ThemeComboBox_SelectionChanged">
                            <ComboBoxItem Content="自动"/>
                            <ComboBoxItem Content="浅色"/>
                            <ComboBoxItem Content="深色"/>
                        </ComboBox>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
            
            <!-- ICS源区域 -->
            <GroupBox Grid.Row="1" Header="订阅日历" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- ICS源列表 -->
                    <DataGrid x:Name="IcsSourcesGrid" 
                              Grid.Row="0"
                              Height="220"
                              AutoGenerateColumns="False" 
                              CanUserAddRows="False"
                              HeadersVisibility="Column"
                              Background="White"
                              RowBackground="White"
                              AlternatingRowBackground="White"
                              BorderThickness="1"
                              BorderBrush="#828790"
                              IsReadOnly="True"
                              SelectionUnit="FullRow"
                              GridLinesVisibility="Horizontal"
                              VerticalGridLinesBrush="Transparent"
                              HorizontalGridLinesBrush="#E0E0E0"
                              SelectionChanged="IcsSourcesGrid_SelectionChanged"
                              MouseDoubleClick="IcsSourcesGrid_MouseDoubleClick">
                              
                        <DataGrid.Resources>
                         <!-- 恢复默认的高亮颜色，使用系统颜色 -->
                         <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="{DynamicResource {x:Static SystemColors.HighlightColorKey}}"/>
                         <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="{DynamicResource {x:Static SystemColors.HighlightTextColorKey}}"/>
                         <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="{DynamicResource {x:Static SystemColors.HighlightColorKey}}"/>
                         <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="{DynamicResource {x:Static SystemColors.HighlightTextColorKey}}"/>
                         
                         <!-- 移除单元格被选中时的虚线框和背景 -->
                         <Style TargetType="DataGridCell">
                             <Setter Property="BorderThickness" Value="0"/>
                             <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                             <Setter Property="VerticalContentAlignment" Value="Center"/>
                             <Setter Property="Template">
                                 <Setter.Value>
                                     <ControlTemplate TargetType="DataGridCell">
                                         <Border Padding="{TemplateBinding Padding}" 
                                                 BorderBrush="{TemplateBinding BorderBrush}" 
                                                 BorderThickness="{TemplateBinding BorderThickness}" 
                                                 Background="{TemplateBinding Background}" 
                                                 SnapsToDevicePixels="True">
                                             <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                         </Border>
                                     </ControlTemplate>
                                 </Setter.Value>
                             </Setter>
                             <Style.Triggers>
                                 <Trigger Property="IsSelected" Value="True">
                                     <!-- 选中时背景设为系统高亮色 -->
                                     <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                     <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                 </Trigger>
                             </Style.Triggers>
                         </Style>
                             
                             <Style TargetType="DataGridRow">
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                             </Style>
                        </DataGrid.Resources>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="名称" Binding="{Binding Name}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTextColumn Header="更新间隔" Binding="{Binding RefreshIntervalDisplay}" Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="ToolTip" Value="{Binding NextRefreshTimeDisplay}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            
                            <DataGridTemplateColumn Header="颜色" Width="50">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Rectangle Width="20" Height="20" RadiusX="4" RadiusY="4" HorizontalAlignment="Center" VerticalAlignment="Center" Stroke="White" StrokeThickness="1">
                                            <Rectangle.Fill>
                                                <SolidColorBrush Color="{Binding Color}"/>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <DataGridCheckBoxColumn Header="启用" Binding="{Binding IsEnabled}" Width="50" IsReadOnly="False">
                                <DataGridCheckBoxColumn.ElementStyle>
                                    <Style TargetType="CheckBox">
                                        <EventSetter Event="Click" Handler="IcsSourceEnabled_Click"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                    </Style>
                                </DataGridCheckBoxColumn.ElementStyle>
                            </DataGridCheckBoxColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    
                    <!-- 按钮栏 -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,0">
                        <Button x:Name="AddIcsSourceButton" 
                                Content="添加" 
                                Margin="0,0,10,0"
                                Click="AddIcsSourceButton_Click"/>
                        
                        <Button x:Name="EditIcsSourceButton" 
                                Content="编辑" 
                                Margin="0,0,10,0"
                                IsEnabled="False"
                                Click="EditIcsSourceButton_Click"/>
                        
                        <Button x:Name="DeleteIcsSourceButton" 
                                Content="删除" 
                                Margin="0,0,10,0"
                                IsEnabled="False"
                                Click="DeleteIcsSourceButton_Click"/>
                                
                        <Button x:Name="RefreshNowButton" 
                                Content="立即刷新" 
                                Click="RefreshNowButton_Click"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
            
        </Grid>
    </Border>
</Window>